# (WIP) OpenShift CI Scenario Prerequisites Guide<!-- omit from toc -->

## Table of Contents<!-- omit from toc -->

- [Overview](#overview)
- [Prerequisites at a Glance](#prerequisites-at-a-glance)
- [Resources](#resources)
- [Upstream Considerations](#upstream-considerations)
  - [1. Public GitHub repositories (preferred)](#1-public-github-repositories-preferred)
  - [2. Private GitHub repositories](#2-private-github-repositories)
- [GitHub Org Requirements](#github-org-requirements)
- [GitHub User Readiness](#github-user-readiness)
- [Containerized Product Deployment](#containerized-product-deployment)
- [Containerized Tests](#containerized-tests)
- [Resolve Internal Dependencies](#resolve-internal-dependencies)
- [Valid Test Output](#valid-test-output)
- [Documented Tests](#documented-tests)
- [Completion](#completion)

## Overview

This doc is meant to be used by Product QE teams to prepare themselves and their testing repositories to run within OpenShift CI.

You will be working through and updating the following information in the prerequisite Jira ticket that you will be assigned when starting this prerequisite process.

>Please reach out to us on the Slack channel [#forum-qe-cspi-ocp-ci](https://coreos.slack.com/archives/C047Y0DPEJU) to let us know that you want to start the prerequisite process so that we can get you started with a prerequisite ticket.

## Prerequisites at a Glance

1. Resources
2. Upstream Considerations
3. GitHub Org Requirements
4. GitHub User Readiness
5. Containerized Product Deployment
6. Containerized Tests
7. Resolve Internal Dependencies
8. Valid Test Output
9. Documented Tests

## Resources

- Identify engineers that are assigned to work on & hold shared responsibility for product onboarding, test execution and ongoing scenario maintenance. See the [Scenario Maintenance Policy](../Policy/Maintenance/Scenario_Maintenance_Policy.md) and this [RACI Chart](RACI_Chart.md) to understand the roles & responsibilities for this onboarding.

## Upstream Considerations

Running in OpenShift CI is by default upstream and open to the public. All generated output and artifacts will be made public when run as a Prow job. This means that the following MUST be true about your layered product deployment and test automation:

- No exposed secrets in the console output of any deployment, config, setup, or test automation.
- No exposed secrets in an XML generated by a test.
- No exposed secrets in any artifact generated from product deployment or product testing.

There are two paths for onboarding your layered product scenario into OpenShift CI that you can take

### 1. Public GitHub repositories (preferred)

- A GitHub organization that can be used for testing within OpenShift CI.
- Layered product deployment automation in public GitHub repositories within that org.
- Layered product testing automation in public GitHub repositories repo within that org.

### 2. Private GitHub repositories

- A GitHub organization that can be used for testing within OpenShift CI.
- Layered product deployment automation in private GitHub repositories within that org (mirrored from your downstream source).
- Layered product testing automation in private GitHub repositories repo within that org (mirrored from your downstream source).

> **IMPORTANT:**
>
>If you need to use private GitHub repos it is the product QE's responsibility to create the Github org, mirror the downstream repos to Github private repos, and maintain that mirror for the lifetime of the scenario.

## GitHub Org Requirements

- [Add Openshift-ci-robot & openshift-merge-robot](https://docs.ci.openshift.org/docs/how-tos/onboarding-a-new-component/#granting-robots-privileges-and-installing-the-github-app) to your Github organization.

## GitHub User Readiness

- Add GitHub usernames to the openshift organization ([follow this guide](https://source.redhat.com/groups/public/atomicopenshift/atomicopenshift_wiki/openshift_onboarding_checklist_for_github)).

## Containerized Product Deployment

- The product can be installed via the operator hub (for GA'd layered products).
- A method to install the operator from the operator hub within a container image.
  - If your product is able to be installed using the steps existing in the  [operatorhub-subscribe ref](https://github.com/openshift/release/tree/master/ci-operator/step-registry/operatorhub/subscribe) than we can make use of that instead.
- Product install configuration (anything that needs to be done post operator install) executed within a container (maintained by the product QE team in upstream repo or reachable registry).
- Identify all environment variables and secrets needed for install.
- All containerization must also be proven to work within an OpenShift cluster, not just proven in a local or special team based container environment.

See the [Container Creation Guide](../OCP_CI_Tutorials/Containers/Container_Creation_Guide.md) for general guidance when creating your layered product deployment image(s).

## Containerized Tests

- Product test environment setup executed within a container image (maintained by product QE team in test repo or reachable registry).
- A script or command that can be run against the test container to trigger and generate an XML for the tests.
- Identified all environment variables and secrets needed for testing.
- All containerization must also be proven to work within an OpenShift cluster, not just proven in a local or special team based container environment.

See the [Container Creation Guide](../OCP_CI_Tutorials/Containers/Container_Creation_Guide.md) for general guidance when creating your scenarios test image(s).

## Resolve Internal Dependencies

- Confirmation that the containerized deployment and testing can be run outside of the company firewall and doesn't rely on internal dependencies.

## Valid Test Output

- Produce JUnit XMLs in a valid format for each test that is executed.
  - This will be needed for reporting.

See [Report Guide](../OCP_CI_Tutorials/Reporting/Reporting_Guide.md) for more information.

## Documented Tests

- Helpful documentation for tests that are being run that can be linked to in the [scenarios README.md](../Policy/Documentation/Scenario_Documentation_Policy.md)

## Completion

We define completion of your teams prerequisites as:

> **All components of the prerequisite Jira ticket being complete and most importantly reviewed, verified, and approved by all parties.** Once the prerequisites are met we expect that the scenario can be implemented without any blockers. This allows us to plan the implementation appropriately as we attempt to do this for 30+ layered products.
>